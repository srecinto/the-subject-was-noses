<html>
    <head>
        <title>The Subject Was Noses - Shooter POC</title>
        <style>
            body {
                background-color: black;
            }
        </style>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.16.1/dist/phaser.js"></script>
        <script>
            var football = null;
            var goodTarget = null;
            var badTarget = null;
            var spacebar = null;
            var crosshairs = null;
            var hasHitBadTarget = false;
            var hasHitGoodTarget = false;
            var score = 0;
            var scoreText = null;
            var messageText = null;


            var Shooter = new Phaser.Class({
                Extends: Phaser.Scene,
                initialize:

                function Shooter () {
                    console.log("Shooter()");
                    Phaser.Scene.call(this, { key: 'shooter' });

                },

                preload: function () {
                    console.log("preload()");
                    this.load.image('backround', 'ShooterJam/brady_bg.png');
                    this.load.image('bush', 'ShooterJam/bush.png');
                    this.load.image('football', 'ShooterJam/football.png');
                    this.load.image('boy', 'ShooterJam/boy.png');
                    this.load.image('girl', 'ShooterJam/Cute_girl.png');
                    this.load.image('crosshairs', 'ShooterJam/crosshairs.png');

                },

                create: function () {
                    console.log("create()");
                    var background = this.add.image(0, 0, 'backround');
                    background.setDisplaySize(800, 600);
                    background.setOrigin(0, 0);

                    scoreText = this.make.text({
                        x: 50,
                        y: 50,
                        text: "Score: " + score,
                        style: {
                            font: "20px monospace",
                            fill: "#ffffff"
                        }
                    });

                    messageText = this.make.text({
                       x: this.sys.game.canvas.width / 2,
                       y: 200,
                        text: "Ready Set Hike!",
                        style: {
                            font: "36px monospace",
                            fill: "#ffffff"
                        },
                        depth: 30
                    });
                    messageText.setOrigin(0.5);

                    var bush_1 = this.add.image(70, 400, 'bush');
                    bush_1.setDepth(10);

                    var bush_2 = this.add.image(700, 400, 'bush');
                    bush_2.setDepth(10);

                    var bush_3 = this.add.image(400, 450, 'bush');
                    bush_3.setDepth(15);

                    goodTarget = this.physics.add.sprite(70, 320, 'boy');
                    goodTarget.setDisplaySize(100, 300);
                    goodTarget.setSize(140, 200);
                    goodTarget.setOffset(100, 100);
                    goodTarget.setDepth(7);

                    badTarget = this.physics.add.sprite(400, 350, 'girl');
                    badTarget.setDisplaySize(200, 300);
                    badTarget.setSize(150, 260);
                    badTarget.setOffset(210, 280);
                    badTarget.setDepth(13);

                    football = this.physics.add.sprite(400, 600, 'football');
                    football.setDisplaySize(72, 72);
                    football.setRotation(2.35);
                    football.setSize(300, 400);
                    football.setOffset(110, 0);
                    football.setDepth(20);
                    //football.setDragY(100);

                    crosshairs = this.physics.add.sprite(400, 550, 'crosshairs');
                    crosshairs.setDisplaySize(32, 32);
                    crosshairs.setSize(50, 50);
                    crosshairs.setOffset(300, 275);
                    crosshairs.setDepth(25);
                    crosshairs.setVisible(false);


                    this.input.on('pointermove', function (pointer) {

                        football.x = Phaser.Math.Clamp(pointer.x, 52, 748);
                        crosshairs.x = Phaser.Math.Clamp(pointer.x, 52, 748);

                    }, this);

                    spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

                    var footballCrosshairCollider = this.physics.add.overlap(football, crosshairs, function (footballOnTarget) {
                        console.log("landed");
                        crosshairs.setVisible(false);
                        footballOnTarget.body.stop();

                        //Check for hit / Miss
                        if(hasHitGoodTarget) {
                            console.log("Hit Good Target!");
                            score += 20;
                            messageText.setColor("#00ff00");
                            messageText.setText("GOOD!");
                        } else if (hasHitBadTarget) {
                            console.log("Hit Bad Target!");
                            score -= 50;
                            messageText.setColor("#ff0000");
                            messageText.setText("OH MY NOSE!");
                        } else {
                            console.log("Missed!");
                            messageText.setColor("#ffff00");
                            messageText.setText("MISS!");
                            score -= 5;
                        }

                        if(score < 0) {
                            score = 0;
                        }

                        scoreText.setText("Score: " + score);

                        // Handle Scoring
                        //Reset
                        football.setY(600);
                        crosshairs.setY(550);
                        this.input.on('pointermove', function (pointer) {

                            football.x = Phaser.Math.Clamp(pointer.x, 52, 748);
                            crosshairs.x = Phaser.Math.Clamp(pointer.x, 52, 748);

                        }, this);

                    }, null, this);

                    var footballBadTargetCollider = this.physics.add.overlap(football, badTarget, function (footballOnTarget) {
                        hasHitBadTarget = true;
                    }, null, this);

                    var footballGoodTargetCollider = this.physics.add.overlap(football, goodTarget, function (footballOnTarget) {
                        hasHitGoodTarget = true;
                    }, null, this);



                },


                update: function () {
                    //console.log("update()");

                    if (Phaser.Input.Keyboard.JustDown(spacebar)) {
                        console.log("set");
                        this.input.off('pointermove');
                        crosshairs.setVisible(true);
                        crosshairs.body.setVelocityY(-100);
                        hasHitGoodTarget = false;
                        hasHitBadTarget = false;
                        //football.body.setVelocityY(-100);
                        //this.physics.moveToObject(football, block, 200);
                    }

                    if (Phaser.Input.Keyboard.JustUp(spacebar)) {
                        console.log("throw");
                        crosshairs.body.stop();
                        this.physics.moveToObject(football, crosshairs, 300);
                    }
                }

            });


        /**
         * Main Game Config - Must come after class declaration otherwise it wont know what was there
         * */
            var config = {
                type: Phaser.WEBGL,
                width: 800,
                height: 600,
                parent: 'gameCanvas',
                scene: [ Shooter ],
                physics: {
                    default: 'arcade',
                    arcade: {
                        debug: true
                    }
                }
            };

            var game = new Phaser.Game(config);


        </script>
    </head>
    <body>
        <div id="gameCanvas"></div>
    </body>
</html>