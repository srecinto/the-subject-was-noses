<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 2</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {                              //for physics system
          default: 'matter',
          matter: {
            gravity: { x: 2,
                      y: 3},
            debug: true
          }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var level;
    var player;
    var cursor;
    var timedEvent;

    var air_particle;

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('amoeba', 'PlatformerJam/amoeba.png');
        this.load.image('ground', 'PlatformerJam/level_ground.png');
        this.load.image('air', 'PlatformerJam/air_particle.png');
    }

    function create ()
    {

        //spawning the terrain/level platform
        level = this.add.image(0, 600, 'ground').setOrigin(0,1);

        //setting bounds around the world
        this.matter.world.setBounds(0, 0, 800, 600, 32, true, true, false, true);

        //actually setting vertices for the body that would encapsulate the terrain
        var path = '0 425 84 391 134 378 202 400 252 418 313 385 333 371 409 379 494 410 587 364 650 363 718 409 747 408 800 367 800 600 0 600';

        var verts = this.matter.verts.fromPath(path);
        var ground = this.matter.add.fromVertices(408, 492, verts, { ignoreGravity: true }, true, 0.01, 10);



        //spawning Red Amoeba (player object)
        player = this.matter.add.image(400, 50, 'amoeba');
        player.xType = "player";
        player.setBody(
        {
          type: 'polygon',
          sides: 7,
          radius: 13

        });

        this.matter.world.on('collisionstart', function (event, bodyA, bodyB) {
          //console.log("collisionstart");
          if(bodyA.gameObject != null && bodyB.gameObject != null) {
            //console.log(bodyB);
            if(bodyB.gameObject.xType == "air_particle") {
              //console.log("HIT_B");
              bodyB.gameObject.visible = false;
              bodyB.gameObject.destroy();
              //bodyB.destroy();
            }

            if(bodyA.gameObject.xType == "air_particle") {
              //console.log("HIT_A");
              bodyA.gameObject.visible = false;
              bodyA.gameObject.destroy();
              //bodyA.destroy();
            }
          }

        }, this);

        cursor = this.input.keyboard.createCursorKeys();
    }

    function update ()
    {

      timedEvent = this.time.delayedCall(Phaser.Math.Between(500,3000), onEvent, [], this);

      if(cursor.left.isDown)
      {
        player.setVelocityX(-4);

      }

      if(cursor.right.isDown)
      {
        player.setVelocityX(4);
      }

      if(cursor.up.isDown)
      {
        player.setVelocityY(-3);
      }
    }

    function onEvent()
    {


      var air_particle = this.matter.add.image(-10 ,Phaser.Math.Between(250, 350), 'air');

      air_particle.xType = "air_particle";
      air_particle.setBody(
        {
          type: 'polygon',
          sides: 7,
          radius: 13
        }
      );
      air_particle.setVelocityX(70);


    }


</script>

</body>
</html>
